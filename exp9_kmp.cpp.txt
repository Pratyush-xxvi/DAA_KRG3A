// exp9_kmp.cpp
#include <bits/stdc++.h>
using namespace std;

vector<int> build_lps(const string &pat){
    int m = pat.size();
    vector<int> lps(m,0);
    for(int i=1, len=0; i<m; ){
        if (pat[i]==pat[len]) lps[i++] = ++len;
        else if (len) len = lps[len-1];
        else lps[i++] = 0;
    }
    return lps;
}

vector<int> kmp_search(const string &text, const string &pat){
    vector<int> occ;
    if (pat.empty()) { // occurrences at every position
        for(int i=0;i<= (int)text.size(); ++i) occ.push_back(i);
        return occ;
    }
    auto lps = build_lps(pat);
    int i=0,j=0;
    while(i < (int)text.size()){
        if (text[i] == pat[j]) { i++; j++; if (j == (int)pat.size()) { occ.push_back(i-j); j = lps[j-1]; } }
        else if (j) j = lps[j-1];
        else i++;
    }
    return occ;
}

int main(){
    string s = "ababcababa";
    string p = "aba";
    auto occ = kmp_search(s,p);
    cout << "Occurrences at indices: ";
    for(int idx: occ) cout << idx << " ";
    cout << "\n";
}
